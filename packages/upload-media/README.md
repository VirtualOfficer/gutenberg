# `@wordpress/upload-media`

Core media upload logic implemented with a custom `@wordpress/data` store.

## Installation

Install the module

```bash
npm install @wordpress/upload-media --save
```

## API Reference

### Actions

The following set of dispatching action creators are available on the object returned by `wp.data.dispatch( 'media-experiments/upload' )`:

<!-- START TOKEN(Autogenerated actions|src/store/actions.ts) -->

#### addItemFromUrl

Adds a new item to the upload queue.

_Parameters_

-   _$0_ `AddItemFromUrlArgs`:
-   _$0.url_ `AddItemFromUrlArgs[ 'url' ]`: URL
-   _$0.onChange_ `[AddItemFromUrlArgs[ 'onChange' ]]`: Function called each time a file or a temporary representation of the file is available.
-   _$0.onSuccess_ `[AddItemFromUrlArgs[ 'onSuccess' ]]`: Function called after the file is uploaded.
-   _$0.onError_ `[AddItemFromUrlArgs[ 'onError' ]]`: Function called when an error happens.
-   _$0.additionalData_ `[AddItemFromUrlArgs[ 'additionalData' ]]`: Additional data to include in the request.

#### addItems

Adds a new item to the upload queue.

_Parameters_

-   _$0_ `AddItemsArgs`:
-   _$0.files_ `AddItemsArgs[ 'files' ]`: Files
-   _$0.onChange_ `[AddItemsArgs[ 'onChange' ]]`: Function called each time a file or a temporary representation of the file is available.
-   _$0.onSuccess_ `[AddItemsArgs[ 'onSuccess' ]]`: Function called after the file is uploaded.
-   _$0.onBatchSuccess_ `[AddItemsArgs[ 'onBatchSuccess' ]]`: Function called after a batch of files is uploaded.
-   _$0.onError_ `[AddItemsArgs[ 'onError' ]]`: Function called when an error happens.
-   _$0.additionalData_ `[AddItemsArgs[ 'additionalData' ]]`: Additional data to include in the request.

#### cancelItem

Cancels an item in the queue based on an error.

_Parameters_

-   _id_ `QueueItemId`: Item ID.
-   _error_ `Error`: Error instance.

#### grantApproval

Approves a proposed optimized/converted version of a file so it can continue being processed and uploaded.

_Parameters_

-   _id_ `number`: Item ID.

#### optimizeExistingItem

Adds a new item to the upload queue for optimizing (compressing) an existing item.

_Parameters_

-   _$0_ `OptimizeExistingItemArgs`:
-   _$0.id_ `OptimizeExistingItemArgs[ 'id' ]`: Attachment ID.
-   _$0.url_ `OptimizeExistingItemArgs[ 'url' ]`: URL.
-   _$0.fileName_ `[OptimizeExistingItemArgs[ 'fileName' ]]`: File name.
-   _$0.poster_ `[OptimizeExistingItemArgs[ 'poster' ]]`: Poster URL.
-   _$0.batchId_ `[OptimizeExistingItemArgs[ 'batchId' ]]`: Batch ID.
-   _$0.onChange_ `[OptimizeExistingItemArgs[ 'onChange' ]]`: Function called each time a file or a temporary representation of the file is available.
-   _$0.onSuccess_ `[OptimizeExistingItemArgs[ 'onSuccess' ]]`: Function called after the file is uploaded.
-   _$0.onBatchSuccess_ `[OptimizeExistingItemArgs[ 'onBatchSuccess' ]]`: Function called after a batch of files is uploaded.
-   _$0.onError_ `[OptimizeExistingItemArgs[ 'onError' ]]`: Function called when an error happens.
-   _$0.additionalData_ `[OptimizeExistingItemArgs[ 'additionalData' ]]`: Additional data to include in the request.
-   _$0.generatedPosterId_ `[OptimizeExistingItemArgs[ 'generatedPosterId' ]]`: Attachment ID of the generated poster image, if it exists.
-   _$0.startTime_ `[OptimizeExistingItemArgs[ 'startTime' ]]`: Time the action was initiated by the user (e.g. by clicking on a button).

#### rejectApproval

Rejects a proposed optimized/converted version of a file by essentially cancelling its further processing.

_Parameters_

-   _id_ `number`: Item ID.

#### updateSettings

Returns an action object that pauses all processing in the queue.

Useful for testing purposes.

_Parameters_

-   _settings_ `Partial< Settings >`:

_Returns_

-   `UpdateSettingsAction`: Action object.

<!-- END TOKEN(Autogenerated actions|src/store/actions.ts) -->

### Selectors

The following selectors are available on the object returned by `wp.data.select( 'media-experiments/upload' )`:

**Note:** Some actions and selectors [will be made private](https://github.com/swissspidy/media-experiments/issues/500) eventually, limiting the public API.

<!-- START TOKEN(Autogenerated selectors|src/store/selectors.ts) -->

#### getComparisonDataForApproval

Returns data to compare the old file vs. the optimized file, given the attachment ID.

Includes both the URLs and the respective file sizes and the size difference in percentage.

_Parameters_

-   _state_ `State`: Upload state.
-   _attachmentId_ `number`: Attachment ID.

_Returns_

-   `{ oldUrl: string | undefined; oldSize: number; newSize: number; newUrl: string | undefined; sizeDiff: number; } | null`: Comparison data.

#### getItems

Returns all items currently being uploaded, without sub-sizes (children).

_Parameters_

-   _state_ `State`: Upload state.

_Returns_

-   `QueueItem[]`: Queue items.

#### getSettings

Returns the media upload settings.

_Parameters_

-   _state_ `State`: Upload state.

_Returns_

-   `Settings`: Settings

#### isFirstPendingApprovalByAttachmentId

Determines whether an item is the first one pending approval given its associated attachment ID.

_Parameters_

-   _state_ `State`: Upload state.
-   _attachmentId_ `number`: Attachment ID.

_Returns_

-   `boolean`: Whether the item is first in the list of items pending approval.

#### isPendingApproval

Determines whether there is an item pending approval.

_Parameters_

-   _state_ `State`: Upload state.

_Returns_

-   `boolean`: Whether there is an item pending approval.

#### isUploading

Determines whether any upload is currently in progress.

_Related_

-   <https://github.com/WordPress/gutenberg/blob/a889ec84318fe5ee9ee76f1226b30283b27c99a7/packages/edit-post/src/components/header/index.js#L35>

_Parameters_

-   _state_ `State`: Upload state.

_Returns_

-   `boolean`: Whether any upload is currently in progress.

#### isUploadingById

Determines whether an upload is currently in progress given an attachment ID.

_Parameters_

-   _state_ `State`: Upload state.
-   _attachmentId_ `number`: Attachment ID.

_Returns_

-   `boolean`: Whether upload is currently in progress for the given attachment.

#### isUploadingByUrl

Determines whether an upload is currently in progress given an attachment URL.

_Parameters_

-   _state_ `State`: Upload state.
-   _url_ `string`: Attachment URL.

_Returns_

-   `boolean`: Whether upload is currently in progress for the given attachment.

<!-- END TOKEN(Autogenerated selectors|src/store/selectors.ts) -->
